<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body class="bg-slate-100 min-h-screen">
    <nav class="bg-sky-800 p-4">
        <div class="container mx-auto space-x-3 flex justify-center text-white">
            <a href="{{ url_for('main.index') }}" class="hover:underline">home</a>
            {% for playlist in playlists %}
            <a href="{{ url_for('main.playlist', playlist_name=playlist) }}" class="hover:underline">{{ playlist }}</a>
            {% endfor %}
        </div>
    </nav>
    <div class="container mx-auto px-4 py-8">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
              <ul>
                {% for message in messages %}
                  <li>{{ message }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </div>
    <script>
    let players = {};
    
    function onYouTubeIframeAPIReady() {
        // The API is ready, but we'll create players on demand
    }
    
    function playAudio(videoId, imgElement) {
        if (!players[videoId]) {
            players[videoId] = new YT.Player('player-' + videoId, {
                height: '0',
                width: '0',
                videoId: videoId,
                playerVars: {
                    'autoplay': 1,
                    'controls': 0,
                },
                events: {
                    'onReady': function(event) {
                        event.target.playVideo();
                        imgElement.style.opacity = '0.5';
                        updateProgressBar(videoId);
                    },
                    'onStateChange': function(event) {
                        if (event.data == YT.PlayerState.PLAYING) {
                            updateProgressBar(videoId);
                        } else {
                            clearInterval(players[videoId].progressInterval);
                        }
                    }
                }
            });
        } else {
            if (players[videoId].getPlayerState() === YT.PlayerState.PLAYING) {
                players[videoId].pauseVideo();
                imgElement.style.opacity = '1';
                clearInterval(players[videoId].progressInterval);
            } else {
                players[videoId].playVideo();
                imgElement.style.opacity = '0.5';
                updateProgressBar(videoId);
            }
        }
    }

    function updateProgressBar(videoId) {
        clearInterval(players[videoId].progressInterval);
        players[videoId].progressInterval = setInterval(() => {
            const player = players[videoId];
            const duration = player.getDuration();
            const currentTime = player.getCurrentTime();
            const progress = (currentTime / duration) * 100;
            const progressBar = document.getElementById('progress-' + videoId);
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
        }, 1000);
    }
    </script>
</body>
</html>
